var o=class{constructor(t,e,n){this.frequency=t;this.sampleRate=e;this.bufferX=[];this.bufferY=[];this.position=0;this.cyclePos=0;this.cycleStep=0;this.length=Math.floor(n*e/t),this.cycleStep=2*Math.PI*t/e;for(let s=0;s<this.length;s++)this.bufferX.push(.5*Math.cos(s*this.cycleStep)),this.bufferY.push(.5*Math.sin(s*this.cycleStep))}next(t){this.bufferX[this.position]=t*Math.cos(this.cyclePos),this.bufferY[this.position]=t*Math.sin(this.cyclePos),this.position=(this.position+1)%this.length,this.cyclePos=(this.cyclePos+this.cycleStep)%(Math.PI*2)}calculateValue(){let t=0,e=0;for(let s=0;s<this.length;s++)t+=this.bufferX[s],e+=this.bufferY[s];return t/=this.length,e/=this.length,Math.sqrt(t*t+e*e)}};var h=class{constructor(t,e,n){this._position=0;this.isFinished=!1;this._input=t,this._tickLength=e.tickLength,this._points=e.points.map(s=>new o(s,n,e.cycles)),this._outputLength=Math.floor(this._input.length/this._tickLength)}analyzeNext(t){if(!this._input||this.isFinished)throw new Error;let e=this._input,n=new Float32Array(t*this._points.length),s=this._position,l=Math.min(t,this._outputLength-this._position);for(let a=0;a<l;a++){for(let r=0;r<this._tickLength;r++){let p=e[r+this._tickLength*(a+this._position)]*.5+.5;this._points.forEach((g,m)=>g.next(p))}this._points.forEach((r,p)=>n[a+p*t]=r.calculateValue())}return this._position+=l,this.isFinished=this._position===this._outputLength,{start:s,end:this._position,output:n}}};addEventListener("message",i=>{switch(i.data.type){case"start":b(i);break;case"resume":break}});var c,f,u;function b(i){f=new Float32Array(i.data.input),u=new h(f,i.data,i.data.sampleRate),c=setInterval(()=>{let t=u.analyzeNext(16);postMessage({type:"result",start:t.start,end:t.end,output:t.output.buffer,hasFinished:u.isFinished},[t.output.buffer]),u.isFinished&&clearInterval(c)})}
