import{$ as s,Da as V,Fa as C,K as p,L as d,La as y,S as f,W as _,X as h,Y as M,Z as H,_ as a,aa as k,ba as Y,c as P,ca as B,cb as q,da as O,ea as m,eb as J,fa as g,g as I,ga as L,ha as X,j as D,ja as A,ka as j,la as N,m as F,ma as v,na as R,p as W,pa as Q,qa as G,ra as K,s as u,sa as $,ta as w,x,y as S}from"./chunk-42UUMBFT.js";var b=(()=>{let i=class i{get zoomY(){return this._zoomY}set zoomY(e){this._zoomY=e,localStorage.setItem("zoomY",e.toString())}get zoomX(){return this._zoomX}set zoomX(e){this._zoomX=e,localStorage.setItem("zoomX",e.toString())}get notes(){return this._service.config}get notes$(){return this._service.context$.pipe(I(e=>e.config))}constructor(e){this._service=e,this._zoomY=+(localStorage.getItem("zoomY")??"1"),this._zoomX=+(localStorage.getItem("zoomX")??"1")}};i.\u0275fac=function(t){return new(t||i)(W(y))},i.\u0275prov=F({token:i,factory:i.\u0275fac});let n=i;return n})();var ie=["*"];function ne(n,i){if(n&1&&(Y(0),a(1,"div",1),v(2),s(),k(3,"div",2),B()),n&2){let c=i.$implicit,e=i.index,t=g();p(),h("height",t.keyHeight*t.context.zoomY,"px"),M("black",c.isBlack),p(),R(" ",c.name," "),p(),h("height",t.keyHeight*t.context.zoomY,"px")("top",t.keyHeight*e*t.context.zoomY,"px"),M("black",c.isBlack)("dividing",c.baseNote==="C"||c.baseNote==="F")}}var Z=(()=>{let i=class i{constructor(e){this.context=e,this.trackBy=(t,o)=>o.index,this.keyHeight=z}};i.\u0275fac=function(t){return new(t||i)(d(b))},i.\u0275cmp=u({type:i,selectors:[["app-keyboard"]],standalone:!0,features:[w],ngContentSelectors:ie,decls:2,vars:2,consts:[[4,"ngFor","ngForOf","ngForTrackBy"],[1,"key"],[1,"highlighter"]],template:function(t,o){t&1&&(L(),f(0,ne,4,13,"ng-container",0),X(1)),t&2&&_("ngForOf",o.context.notes.notes)("ngForTrackBy",o.trackBy)},dependencies:[C,V],styles:["[_nghost-%COMP%]{position:relative;display:block;border-style:solid;border-color:#000;border-width:0px 1px;box-sizing:border-box}.key[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none;overflow:hidden;font-size:8px;box-sizing:border-box;border:2px outset rgba(0,0,0,.3333333333);border-top-color:#fff9;border-left:none;background-color:#aaa;color:#222}.key.black[_ngcontent-%COMP%]{background-color:#222;color:#aaa}.highlighter[_ngcontent-%COMP%]{position:absolute;left:0;width:100vw;box-sizing:border-box}.highlighter[_ngcontent-%COMP%]:not(.black){background-color:var(--white-key-bg, rgba(255, 255, 255, .0666666667))}.highlighter[_ngcontent-%COMP%]:hover{background-color:var(--selected-key-bg, rgba(255, 255, 255, .1333333333));-webkit-backdrop-filter:brightness(3);backdrop-filter:brightness(3)}.highlighter.dividing[_ngcontent-%COMP%]{border-bottom:2px solid var(--key-divider-bg, rgba(255, 255, 255, .1333333333))}"]});let n=i;return n})();var re=["canvas"];function ae(n,i){if(n&1&&k(0,"canvas",2,0),n&2){let c=i.index,e=g();h("width",e.blockWidth*e.viewport.zoomX,"px")("height",e.blockHeight*e.viewport.zoomY,"px")("left",c*e.blockWidth*e.viewport.zoomX,"px"),_("width",e.blockLength)("height",e.blockVerticalLength)}}var ee=(()=>{let i=class i{constructor(e,t){this._service=e,this.viewport=t,this.contexts=[],this.blocksCount=0,this.blockLength=0,this.blockWidth=0,this.blocks=[],this.blockVerticalLength=0,this.blockHeight=0,this._subscription=new P,this._service.context$.subscribe(o=>{this.renderedData=new ImageData(o.render.data,o.render.length,o.render.height),this.blockVerticalLength=o.render.height,this.blockHeight=o.config.count*z,this.blockLength=128,this.blockWidth=this.blockLength*o.config.tickLength/o.sampleRate*te,this.blocksCount=Math.ceil(o.render.length/this.blockLength);let r=[];for(let l=0;l<this.blocksCount;l++)r[l]={};this.blocks=r,this._dataChangesSubscription=o.render.changes.subscribe(l=>{this.drawArea(l.from,l.to)})})}ngOnInit(){}ngOnDestroy(){this._subscription.unsubscribe(),this._dataChangesSubscription?.unsubscribe()}ngAfterViewInit(){let e=this.canvases.changes.pipe(D(!0)).subscribe(()=>{this.contexts=this.canvases.map(t=>t.nativeElement.getContext("2d"))});this._subscription.add(e)}_drawBlock(e,t,o){this.contexts[e].putImageData(this.renderedData,-this.blockLength*e,0,t,0,o,this.blockVerticalLength)}drawArea(e=0,t=this.renderedData.width){let o=Math.floor(e/this.blockLength);for(;e<t;){let r=(o+1)*this.blockLength;if(t<r){this._drawBlock(o,e,t-e);break}this._drawBlock(o,e,r-e),e=r,o++}}};i.\u0275fac=function(t){return new(t||i)(d(y),d(b))},i.\u0275cmp=u({type:i,selectors:[["app-spectrogram-renderer"]],viewQuery:function(t,o){if(t&1&&A(re,5),t&2){let r;j(r=N())&&(o.canvases=r)}},standalone:!0,features:[w],decls:1,vars:1,consts:[["canvas",""],[3,"width","height","left",4,"ngFor","ngForOf"],[3,"width","height"]],template:function(t,o){t&1&&f(0,ae,2,8,"canvas",1),t&2&&_("ngForOf",o.blocks)},dependencies:[C,V],styles:["canvas[_ngcontent-%COMP%]{position:absolute;image-rendering:pixelated}"]});let n=i;return n})();function ce(n,i){if(n&1){let c=O();a(0,"button",11),m("click",function(){x(c);let t=g();return S(t.service.startWorker())}),a(1,"span",12),v(2,"troubleshoot"),s()()}}function se(n,i){if(n&1){let c=O();a(0,"button",13),m("click",function(){x(c);let t=g();return S(t.service.suspendWorker())}),a(1,"span",12),v(2,"settings"),s()()}}function le(n,i){if(n&1){let c=O();a(0,"button",14),m("click",function(){x(c);let t=g();return S(t.service.startWorker())}),a(1,"span",12),v(2,"troubleshoot"),s()()}}var z=12,te=256,ze=(()=>{let i=class i{constructor(e,t){this.viewport=e,this.service=t,this.noteHeight=z,this.keyboardWidth=100,this.previewResize=null}ngOnInit(){}ngOnDestroy(){}};i.\u0275fac=function(t){return new(t||i)(d(b),d(y))},i.\u0275cmp=u({type:i,selectors:[["app-viewport"]],standalone:!0,features:[$([b]),w],decls:13,vars:10,consts:[[1,"scroll-container"],[1,"scrollable-content"],[3,"valueChange","value","min","max"],[1,"icon-button","large","centered-item","floating-btn"],[1,"icon-button","rotating-animation","large","floating-btn","at-right-corner"],[1,"icon-button","large","floating-btn","at-right-corner"],["path","view/zoom/zoom_in_x",3,"click"],["path","view/zoom/zoom_out_x",3,"click"],["path","view/zoom/zoom_in_y",3,"click"],["path","view/zoom/zoom_out_y",3,"click"],["path","view/zoom/reset",3,"click"],[1,"icon-button","large","centered-item","floating-btn",3,"click"],[1,"mat-icon"],[1,"icon-button","rotating-animation","large","floating-btn","at-right-corner",3,"click"],[1,"icon-button","large","floating-btn","at-right-corner",3,"click"]],template:function(t,o){if(t&1&&(a(0,"div",0)(1,"div",1),k(2,"app-spectrogram-renderer"),s(),a(3,"app-keyboard")(4,"app-resize-handle",2),K("valueChange",function(l){return G(o.keyboardWidth,l)||(o.keyboardWidth=l),l}),s()()(),f(5,ce,3,0,"button",3)(6,se,3,0,"button",4)(7,le,3,0,"button",5),a(8,"app-toolbar-action",6),m("click",function(){return o.viewport.zoomX=o.viewport.zoomX*2}),s(),a(9,"app-toolbar-action",7),m("click",function(){return o.viewport.zoomX=o.viewport.zoomX/2}),s(),a(10,"app-toolbar-action",8),m("click",function(){return o.viewport.zoomY=o.viewport.zoomY*2}),s(),a(11,"app-toolbar-action",9),m("click",function(){return o.viewport.zoomY=o.viewport.zoomY/2}),s(),a(12,"app-toolbar-action",10),m("click",function(){return o.viewport.zoomX=1,o.viewport.zoomY=1}),s()),t&2){let r;p(),h("height",o.viewport.notes.count*o.noteHeight*o.viewport.zoomY)("left",o.keyboardWidth,"px"),p(2),h("width",o.keyboardWidth,"px"),p(),Q("value",o.keyboardWidth),_("min",20)("max",200),p(),H((r=o.service.analyzerState)==="initialized"?5:r==="analyzing"?6:r==="suspended"?7:-1)}},dependencies:[C,Z,ee,q,J],styles:["[_nghost-%COMP%]{display:block;position:relative;background-color:#000}.scroll-container[_ngcontent-%COMP%]{overflow:scroll;position:absolute;inset:0}.scrollable-content[_ngcontent-%COMP%]{position:absolute;top:0}app-keyboard[_ngcontent-%COMP%]{position:sticky;left:0}app-resize-handle[_ngcontent-%COMP%]{display:block;cursor:e-resize;position:absolute;top:0;bottom:0;right:0;translate:50% 0;border-right-style:solid;border-right-width:5px;border-color:#0000}app-resize-handle[_ngcontent-%COMP%]:hover{border-color:#fff2}app-resize-handle.dragging[_ngcontent-%COMP%]{border-color:#fff9}.floating-btn[_ngcontent-%COMP%]{position:absolute;z-index:2}.at-right-corner[_ngcontent-%COMP%]{top:16px;right:32px}"]});let n=i;return n})();export{z as BASE_NOTE_HEIGHT,te as BASE_SECOND_WIDTH,ze as ViewportComponent};
