var h=class{constructor(t,e,a){this.frequency=t;this.sampleRate=e;this.bufferX=[];this.bufferY=[];this.position=0;this.cyclePos=0;this.cycleStep=0;this.length=Math.floor(a*e/t),this.cycleStep=2*Math.PI*t/e;for(let s=0;s<this.length;s++)this.bufferX.push(.5*Math.cos(s*this.cycleStep)),this.bufferY.push(.5*Math.sin(s*this.cycleStep))}next(t){this.bufferX[this.position]=t*Math.cos(this.cyclePos),this.bufferY[this.position]=t*Math.sin(this.cyclePos),this.position=(this.position+1)%this.length,this.cyclePos=(this.cyclePos+this.cycleStep)%(Math.PI*2)}calculateValue(){let t=0,e=0;for(let s=0;s<this.length;s++)t+=this.bufferX[s],e+=this.bufferY[s];return t/=this.length,e/=this.length,Math.sqrt(t*t+e*e)}};var u=class{constructor(t,e,a){this._position=0;this.isFinished=!1;this._input=t,this._tickLength=e.tickLength,this._points=e.points.map(s=>new h(s,a,e.cycles)),this._outputLength=Math.floor(this._input.length/this._tickLength)}analyzeNext(t){if(!this._input||this.isFinished)throw new Error;let e=this._input,a=new Float32Array(t*this._points.length),s=this._position,c=Math.min(t,this._outputLength-this._position);for(let o=0;o<c;o++){for(let r=0;r<this._tickLength;r++){let p=e[r+this._tickLength*(o+this._position)]*.5+.5;this._points.forEach((f,m)=>f.next(p))}this._points.forEach((r,p)=>a[o+p*t]=r.calculateValue())}return this._position+=c,this.isFinished=this._position===this._outputLength,{start:s,end:this._position,output:a}}};addEventListener("message",i=>{switch(i.data.type){case"init":M(i);break;case"start":b(i);break;case"suspend":y(i);break}});var n,g,l;function M(i){g=new Float32Array(i.data.input),l=new u(g,i.data,i.data.sampleRate)}function b(i){if(n!=null)throw new Error;postMessage({type:"state",state:"analyzing"}),n=setInterval(()=>{let t=l.analyzeNext(16);postMessage({type:"result",start:t.start,end:t.end,output:t.output.buffer},[t.output.buffer]),l.isFinished&&n!=null&&(clearInterval(n),n=void 0,postMessage({type:"state",state:"finished"}))})}function y(i){if(n==null)throw new Error;clearInterval(n),n=void 0,postMessage({type:"state",state:"suspended"})}
