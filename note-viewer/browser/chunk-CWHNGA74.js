import{Aa as d,Jb as _,Lb as b,N as S,Pa as v,Qb as x,Rb as Q,T as D,Ta as p,Ua as a,Va as w,Wa as u,Xa as k,Y as F,Ya as g,Za as E,_a as H,c as M,ca as h,cb as C,db as z,eb as T,gb as B,hb as I,ib as W,kb as L,lb as A,nb as N,ob as V,p as P,pb as j,qb as R,rb as m,za as s}from"./chunk-43KPJDWY.js";var f=(()=>{let o=class o{get notes(){return this._service.notesConfig}get notes$(){return this._service.context$.pipe(P(t=>t.notes))}constructor(t){this._service=t,this.zoomY=1,this.zoomX=1}};o.\u0275fac=function(e){return new(e||o)(F(x))},o.\u0275prov=D({token:o,factory:o.\u0275fac});let n=o;return n})();var J=["*"];function U(n,o){if(n&1&&(E(0),u(1,"div",1),L(2),k(),g(3,"div",2),H()),n&2){let c=o.$implicit,t=o.index,e=C();s(),a("height",e.keyHeight,"px"),w("black",c.isBlack),s(),A(" ",c.name," "),s(),a("height",e.keyHeight,"px")("top",e.keyHeight*t,"px"),w("black",c.isBlack)("dividing",c.baseNote==="C"||c.baseNote==="F")}}var K=(()=>{let o=class o{constructor(t){this.context=t,this.trackBy=(e,i)=>i.index,this.keyHeight=y}};o.\u0275fac=function(e){return new(e||o)(d(f))},o.\u0275cmp=h({type:o,selectors:[["app-keyboard"]],standalone:!0,features:[m],ngContentSelectors:J,decls:2,vars:2,consts:[[4,"ngFor","ngForOf","ngForTrackBy"],[1,"key"],[1,"highlighter"]],template:function(e,i){e&1&&(z(),v(0,U,4,13,"ng-container",0),T(1)),e&2&&p("ngForOf",i.context.notes.notes)("ngForTrackBy",i.trackBy)},dependencies:[b,_],styles:["[_nghost-%COMP%]{position:relative;display:block;border-style:solid;border-color:#000;border-width:0px 1px;box-sizing:border-box}.key[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none;overflow:hidden;font-size:12px;box-sizing:border-box;border:2px outset rgba(0,0,0,.3333333333);border-top-color:#fff9;border-left:none;background-color:#aaa;color:#222}.key.black[_ngcontent-%COMP%]{background-color:#222;color:#aaa}.highlighter[_ngcontent-%COMP%]{position:absolute;left:0;width:100vw;box-sizing:border-box}.highlighter[_ngcontent-%COMP%]:not(.black){background-color:#ffffff05}.highlighter[_ngcontent-%COMP%]:hover{-webkit-backdrop-filter:brightness(2);backdrop-filter:brightness(2)}.highlighter.dividing[_ngcontent-%COMP%]{border-bottom:2px solid rgba(255,255,255,.1333333333)}"]});let n=o;return n})();var Z=["canvas"];function ee(n,o){if(n&1&&g(0,"canvas",2,0),n&2){let c=o.index,t=C();a("width",t.blockWidth,"px")("height",t.blockHeight,"px")("left",c*t.blockWidth,"px"),p("width",t.blockLength)("height",t.blockVerticalLength)}}var Y=(()=>{let o=class o{constructor(t){this._service=t,this.contexts=[],this.blocksCount=0,this.blockLength=0,this.blockWidth=0,this.blocks=[],this.blockVerticalLength=0,this.blockHeight=0,this._subscription=new M,this._service.context$.subscribe(({data:e,notes:i})=>{this.renderedData=new ImageData(e.renderedData,e.length,e.height),this.blockVerticalLength=e.height,this.blockHeight=i.count*y,this.blockLength=128,this.blockWidth=this.blockLength/e.rate*$,this.blocksCount=Math.ceil(e.length/this.blockLength);let r=[];for(let l=0;l<this.blocksCount;l++)r[l]={};this.blocks=r})}ngOnInit(){}ngOnDestroy(){this._subscription.unsubscribe()}ngAfterViewInit(){let t=this.canvases.changes.pipe(S(!0)).subscribe(()=>{console.log("Total rerender"),this.contexts=this.canvases.map(e=>e.nativeElement.getContext("2d")),this.drawArea()});this._subscription.add(t)}_drawBlock(t,e,i){this.contexts[t].putImageData(this.renderedData,-this.blockLength*t,0,e,0,i,this.blockVerticalLength)}drawArea(t=0,e=this.renderedData.width){let i=Math.floor(t/this.blockLength);for(;t<e;){let r=(i+1)*this.blockLength;if(e<r){this._drawBlock(i,t,e-t);break}this._drawBlock(i,t,r-t),t=r,i++}}};o.\u0275fac=function(e){return new(e||o)(d(x))},o.\u0275cmp=h({type:o,selectors:[["app-spectrogram-renderer"]],viewQuery:function(e,i){if(e&1&&B(Z,5),e&2){let r;I(r=W())&&(i.canvases=r)}},standalone:!0,features:[m],decls:1,vars:1,consts:[["canvas",""],[3,"width","height","left",4,"ngFor","ngForOf"],[3,"width","height"]],template:function(e,i){e&1&&v(0,ee,2,8,"canvas",1),e&2&&p("ngForOf",i.blocks)},dependencies:[b,_],styles:["canvas[_ngcontent-%COMP%]{position:absolute;image-rendering:pixelated}"]});let n=o;return n})();var y=16,$=256,me=(()=>{let o=class o{constructor(t){this.context=t,this.noteHeight=y,this.keyboardWidth=100,this.previewResize=null}ngOnInit(){}ngOnDestroy(){}};o.\u0275fac=function(e){return new(e||o)(d(f))},o.\u0275cmp=h({type:o,selectors:[["app-viewport"]],standalone:!0,features:[R([f]),m],decls:5,vars:9,consts:[[1,"scroll-container"],[1,"scrollable-content"],[3,"valueChange","value","min","max"]],template:function(e,i){e&1&&(u(0,"div",0)(1,"div",1),g(2,"app-spectrogram-renderer"),k(),u(3,"app-keyboard")(4,"app-resize-handle",2),j("valueChange",function(l){return V(i.keyboardWidth,l)||(i.keyboardWidth=l),l}),k()()()),e&2&&(s(),a("height",i.context.notes.count*i.noteHeight*i.context.zoomY)("left",i.keyboardWidth,"px"),s(2),a("width",i.keyboardWidth,"px"),s(),N("value",i.keyboardWidth),p("min",20)("max",200))},dependencies:[b,K,Y,Q],styles:["[_nghost-%COMP%]{display:block;position:relative;background-color:#000}.scroll-container[_ngcontent-%COMP%]{overflow:scroll;position:absolute;inset:0}.scrollable-content[_ngcontent-%COMP%]{position:absolute;top:0}app-keyboard[_ngcontent-%COMP%]{position:sticky;left:0}app-resize-handle[_ngcontent-%COMP%]{display:block;cursor:e-resize;position:absolute;top:0;bottom:0;right:0;translate:50% 0;border-right-style:solid;border-right-width:5px;border-color:#0000}app-resize-handle[_ngcontent-%COMP%]:hover{border-color:#fff2}app-resize-handle.dragging[_ngcontent-%COMP%]{border-color:#fff9}"]});let n=o;return n})();export{y as BASE_NOTE_HEIGHT,$ as BASE_SECOND_WIDTH,me as ViewportComponent};
