import{Aa as H,Ba as a,Ca as p,Da as f,E as F,Ea as I,Fa as B,Ga as S,H as W,Ia as O,Ja as d,Ka as L,La as A,N as m,Na as j,Oa as N,Pa as R,Ra as u,Sa as Q,T as x,U as w,Ua as G,Va as K,Wa as Y,Xa as $,Ya as _,c as T,ga as c,ha as h,i as E,lb as M,nb as k,ta as b,ub as v,vb as q,xa as g,y as D,ya as l,za as V}from"./chunk-4X7QQTZW.js";var C=(()=>{let i=class i{get notes(){return this._service.config}get notes$(){return this._service.context$.pipe(E(t=>t.config))}constructor(t){this._service=t,this.zoomY=1,this.zoomX=1}};i.\u0275fac=function(e){return new(e||i)(W(v))},i.\u0275prov=F({token:i,factory:i.\u0275fac});let o=i;return o})();var ie=["*"];function ne(o,i){if(o&1&&(I(0),a(1,"div",1),u(2),p(),f(3,"div",2),B()),o&2){let s=i.$implicit,t=i.index,e=d();c(),l("height",e.keyHeight,"px"),V("black",s.isBlack),c(),Q(" ",s.name," "),c(),l("height",e.keyHeight,"px")("top",e.keyHeight*t,"px"),V("black",s.isBlack)("dividing",s.baseNote==="C"||s.baseNote==="F")}}var U=(()=>{let i=class i{constructor(t){this.context=t,this.trackBy=(e,n)=>n.index,this.keyHeight=y}};i.\u0275fac=function(e){return new(e||i)(h(C))},i.\u0275cmp=m({type:i,selectors:[["app-keyboard"]],standalone:!0,features:[_],ngContentSelectors:ie,decls:2,vars:2,consts:[[4,"ngFor","ngForOf","ngForTrackBy"],[1,"key"],[1,"highlighter"]],template:function(e,n){e&1&&(L(),b(0,ne,4,13,"ng-container",0),A(1)),e&2&&g("ngForOf",n.context.notes.notes)("ngForTrackBy",n.trackBy)},dependencies:[k,M],styles:["[_nghost-%COMP%]{position:relative;display:block;border-style:solid;border-color:#000;border-width:0px 1px;box-sizing:border-box}.key[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none;overflow:hidden;font-size:8px;box-sizing:border-box;border:2px outset rgba(0,0,0,.3333333333);border-top-color:#fff9;border-left:none;background-color:#aaa;color:#222}.key.black[_ngcontent-%COMP%]{background-color:#222;color:#aaa}.highlighter[_ngcontent-%COMP%]{position:absolute;left:0;width:100vw;box-sizing:border-box}.highlighter[_ngcontent-%COMP%]:not(.black){background-color:#ffffff05}.highlighter[_ngcontent-%COMP%]:hover{-webkit-backdrop-filter:brightness(2);backdrop-filter:brightness(2)}.highlighter.dividing[_ngcontent-%COMP%]{border-bottom:2px solid rgba(255,255,255,.1333333333)}"]});let o=i;return o})();var oe=["canvas"];function re(o,i){if(o&1&&f(0,"canvas",2,0),o&2){let s=i.index,t=d();l("width",t.blockWidth,"px")("height",t.blockHeight,"px")("left",s*t.blockWidth,"px"),g("width",t.blockLength)("height",t.blockVerticalLength)}}var Z=(()=>{let i=class i{constructor(t){this._service=t,this.contexts=[],this.blocksCount=0,this.blockLength=0,this.blockWidth=0,this.blocks=[],this.blockVerticalLength=0,this.blockHeight=0,this._subscription=new T,this._service.context$.subscribe(e=>{this.renderedData=new ImageData(e.render.data,e.render.length,e.render.height),this.blockVerticalLength=e.render.height,this.blockHeight=e.config.count*y,this.blockLength=128,this.blockWidth=this.blockLength*e.config.tickLength/e.sampleRate*ee,this.blocksCount=Math.ceil(e.render.length/this.blockLength);let n=[];for(let r=0;r<this.blocksCount;r++)n[r]={};this.blocks=n,this._dataChangesSubscription=e.render.changes.subscribe(r=>{this.drawArea(r.from,r.to)})})}ngOnInit(){}ngOnDestroy(){this._subscription.unsubscribe()}ngAfterViewInit(){let t=this.canvases.changes.pipe(D(!0)).subscribe(()=>{this.contexts=this.canvases.map(e=>e.nativeElement.getContext("2d"))});this._subscription.add(t)}_drawBlock(t,e,n){this.contexts[t].putImageData(this.renderedData,-this.blockLength*t,0,e,0,n,this.blockVerticalLength)}drawArea(t=0,e=this.renderedData.width){let n=Math.floor(t/this.blockLength);for(;t<e;){let r=(n+1)*this.blockLength;if(e<r){this._drawBlock(n,t,e-t);break}this._drawBlock(n,t,r-t),t=r,n++}}};i.\u0275fac=function(e){return new(e||i)(h(v))},i.\u0275cmp=m({type:i,selectors:[["app-spectrogram-renderer"]],viewQuery:function(e,n){if(e&1&&j(oe,5),e&2){let r;N(r=R())&&(n.canvases=r)}},standalone:!0,features:[_],decls:1,vars:1,consts:[["canvas",""],[3,"width","height","left",4,"ngFor","ngForOf"],[3,"width","height"]],template:function(e,n){e&1&&b(0,re,2,8,"canvas",1),e&2&&g("ngForOf",n.blocks)},dependencies:[k,M],styles:["canvas[_ngcontent-%COMP%]{position:absolute;image-rendering:pixelated}"]});let o=i;return o})();function se(o,i){if(o&1){let s=S();a(0,"button",6),O("click",function(){x(s);let e=d();return w(e.service.startWorker())}),a(1,"span",7),u(2,"troubleshoot"),p()()}}function ae(o,i){if(o&1){let s=S();a(0,"button",8),O("click",function(){x(s);let e=d();return w(e.service.suspendWorker())}),a(1,"span",7),u(2,"settings"),p()()}}function ce(o,i){if(o&1){let s=S();a(0,"button",9),O("click",function(){x(s);let e=d();return w(e.service.startWorker())}),a(1,"span",7),u(2,"troubleshoot"),p()()}}var y=12,ee=256,ye=(()=>{let i=class i{constructor(t,e){this.context=t,this.service=e,this.noteHeight=y,this.keyboardWidth=100,this.previewResize=null}ngOnInit(){}ngOnDestroy(){}};i.\u0275fac=function(e){return new(e||i)(h(C),h(v))},i.\u0275cmp=m({type:i,selectors:[["app-viewport"]],standalone:!0,features:[$([C]),_],decls:8,vars:10,consts:[[1,"scroll-container"],[1,"scrollable-content"],[3,"valueChange","value","min","max"],[1,"icon-button","large","centered-item","floating-btn"],[1,"icon-button","rotating-animation","large","floating-btn","at-right-corner"],[1,"icon-button","large","floating-btn","at-right-corner"],[1,"icon-button","large","centered-item","floating-btn",3,"click"],[1,"mat-icon"],[1,"icon-button","rotating-animation","large","floating-btn","at-right-corner",3,"click"],[1,"icon-button","large","floating-btn","at-right-corner",3,"click"]],template:function(e,n){if(e&1&&(a(0,"div",0)(1,"div",1),f(2,"app-spectrogram-renderer"),p(),a(3,"app-keyboard")(4,"app-resize-handle",2),Y("valueChange",function(P){return K(n.keyboardWidth,P)||(n.keyboardWidth=P),P}),p()()(),b(5,se,3,0,"button",3)(6,ae,3,0,"button",4)(7,ce,3,0,"button",5)),e&2){let r;c(),l("height",n.context.notes.count*n.noteHeight*n.context.zoomY)("left",n.keyboardWidth,"px"),c(2),l("width",n.keyboardWidth,"px"),c(),G("value",n.keyboardWidth),g("min",20)("max",200),c(),H((r=n.service.analyzerState)==="initialized"?5:r==="analyzing"?6:r==="suspended"?7:-1)}},dependencies:[k,U,Z,q],styles:["[_nghost-%COMP%]{display:block;position:relative;background-color:#000}.scroll-container[_ngcontent-%COMP%]{overflow:scroll;position:absolute;inset:0}.scrollable-content[_ngcontent-%COMP%]{position:absolute;top:0}app-keyboard[_ngcontent-%COMP%]{position:sticky;left:0}app-resize-handle[_ngcontent-%COMP%]{display:block;cursor:e-resize;position:absolute;top:0;bottom:0;right:0;translate:50% 0;border-right-style:solid;border-right-width:5px;border-color:#0000}app-resize-handle[_ngcontent-%COMP%]:hover{border-color:#fff2}app-resize-handle.dragging[_ngcontent-%COMP%]{border-color:#fff9}.floating-btn[_ngcontent-%COMP%]{position:absolute;z-index:2}.at-right-corner[_ngcontent-%COMP%]{top:16px;right:32px}"]});let o=i;return o})();export{y as BASE_NOTE_HEIGHT,ee as BASE_SECOND_WIDTH,ye as ViewportComponent};
