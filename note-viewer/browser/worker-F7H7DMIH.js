var h=class{constructor(t,e,n){this._bufferX=[];this._bufferY=[];this._position=0;this._cyclePos=0;this._cycleStep=0;this._length=Math.floor(n*e/t),this._cycleStep=2*Math.PI*t/e;for(let s=0;s<this._length;s++)this._bufferX.push(.5*Math.cos(s*this._cycleStep)),this._bufferY.push(.5*Math.sin(s*this._cycleStep))}next(t){this._bufferX[this._position]=t*Math.cos(this._cyclePos),this._bufferY[this._position]=t*Math.sin(this._cyclePos),this._position=(this._position+1)%this._length,this._cyclePos=(this._cyclePos+this._cycleStep)%(Math.PI*2)}calculateValue(){let t=0,e=0;for(let s=0;s<this._length;s++)t+=this._bufferX[s],e+=this._bufferY[s];return t/=this._length,e/=this._length,Math.sqrt(t*t+e*e)}};var u=class{constructor(t,e,n){this._position=0;this.isFinished=!1;this._input=t,this._tickLength=e.tickLength,this._points=e.points.map(s=>new h(s,n,e.cycles)),this._outputLength=Math.floor(this._input.length/this._tickLength)}analyzeNext(t){if(!this._input||this.isFinished)throw new Error;let e=this._input,n=new Float32Array(t*this._points.length),s=this._position,_=Math.min(t,this._outputLength-this._position);for(let o=0;o<_;o++){for(let r=0;r<this._tickLength;r++){let l=e[r+this._tickLength*(o+this._position)]*.5+.5;this._points.forEach((f,d)=>f.next(l))}this._points.forEach((r,l)=>n[o+l*t]=r.calculateValue())}return this._position+=_,this.isFinished=this._position===this._outputLength,{start:s,end:this._position,output:n}}};addEventListener("message",i=>{switch(i.data.type){case"init":M(i);break;case"start":y(i);break;case"suspend":b(i);break}});var a,g,c,p=32;function M(i){g=new Float32Array(i.data.input),c=new u(g,i.data,i.data.sampleRate)}function y(i){if(a!=null)throw new Error;postMessage({type:"state",state:"analyzing"}),a=setInterval(()=>{let t=Date.now(),e=Math.max(Math.round(p),2),n=c.analyzeNext(e),s=Date.now()-t;p=p*.5+100*p/s*.5,postMessage({type:"result",start:n.start,end:n.end,output:n.output.buffer},[n.output.buffer]),c.isFinished&&a!=null&&(clearInterval(a),a=void 0,postMessage({type:"state",state:"finished"}))})}function b(i){if(a==null)throw new Error;clearInterval(a),a=void 0,postMessage({type:"state",state:"suspended"})}
